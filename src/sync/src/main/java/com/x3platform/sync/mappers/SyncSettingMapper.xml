<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.x3platform.sync.mappers.SyncSettingMapper">
  <resultMap id="BaseResultMap" type="com.x3platform.sync.models.SyncSetting">
    <result property="id" jdbcType="VARCHAR" column="id"/>
    <result property="originDataSourceName" jdbcType="VARCHAR" column="origin_data_source_name"/>
    <result property="targetDataSourceName" jdbcType="VARCHAR" column="target_data_source_name"/>
    <result property="tableName" jdbcType="VARCHAR" column="table_name"/>
    <result property="fields" jdbcType="VARCHAR" column="fields"/>
    <result property="modifiedDateField" jdbcType="VARCHAR" column="modified_date_field"/>
    <result property="applicationIdField" jdbcType="VARCHAR" column="application_id_field"/>
    <result property="syncType" jdbcType="INTEGER" column="sync_type"/>
    <result property="orderId" jdbcType="VARCHAR" column="order_id"/>
    <result property="status" jdbcType="INTEGER" column="status"/>
    <result property="modifiedDate" jdbcType="TIMESTAMP" column="modified_date"/>
    <result property="createdDate" jdbcType="TIMESTAMP" column="created_date"/>
  </resultMap>
  <sql id="Select_Where_Clause">
    <where>
      <!-- 默认查询场景 -->
      <if test="var_scene == 'default'">
        <if test="param_id != null and param_id != ''">
          AND t.id = #{param_id}
        </if>
        <if test="param_origin_data_source_name != null and param_origin_data_source_name != ''">
          AND t.origin_data_source_name = #{param_origin_data_source_name}
        </if>
        <if test="param_target_data_source_name != null and param_target_data_source_name != ''">
          AND t.target_data_source_name = #{param_target_data_source_name}
        </if>
        <if test="param_table_name != null and param_table_name != ''">
          AND t.table_name = #{param_table_name}
        </if>
        <if test="param_fields != null and param_fields != ''">
          AND t.fields = #{param_fields}
        </if>
        <if test="param_modified_date_field != null and param_modified_date_field != ''">
          AND t.modified_date_field = #{param_modified_date_field}
        </if>
        <if test="param_application_id_field != null and param_application_id_field != ''">
          AND t.application_id_field = #{param_application_id_field}
        </if>
        <if test="param_sync_type != null">
          AND t.sync_type = #{param_sync_type}
        </if>
        <if test="param_order_id != null and param_order_id != ''">
          AND t.order_id = #{param_order_id}
        </if>
        <if test="param_status != null">
          AND t.status = #{param_status}
        </if>
        <if test="param_modified_date != null">
          AND t.modified_date = #{param_modified_date}
        </if>
        <if test="param_created_date != null">
          AND t.created_date = #{param_created_date}
        </if>
      </if>
    </where>
  </sql>
  <insert id="insert" parameterType="com.x3platform.sync.models.SyncSetting">
    INSERT INTO sync_setting
    (
      id,
      origin_data_source_name,
      target_data_source_name,
      table_name,
      fields,
      modified_date_field,
      application_id_field,
      sync_type,
      order_id,
      status,
      modified_date,
      created_date
    )
    VALUES
      (
        #{id,jdbcType=VARCHAR},
        #{originDataSourceName,jdbcType=VARCHAR},
        #{targetDataSourceName,jdbcType=VARCHAR},
        #{tableName,jdbcType=VARCHAR},
        #{fields,jdbcType=VARCHAR},
        #{modifiedDateField,jdbcType=VARCHAR},
        #{applicationIdField,jdbcType=VARCHAR},
        #{syncType,jdbcType=INTEGER},
        #{orderId,jdbcType=VARCHAR},
        #{status,jdbcType=INTEGER},
        CURRENT_TIMESTAMP,
        CURRENT_TIMESTAMP
      )
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.x3platform.sync.models.SyncSetting">
    UPDATE sync_setting
    SET

      origin_data_source_name = #{originDataSourceName,jdbcType=VARCHAR},
      target_data_source_name = #{targetDataSourceName,jdbcType=VARCHAR},
      table_name              = #{tableName,jdbcType=VARCHAR},
      fields                  = #{fields,jdbcType=VARCHAR},
      modified_date_field     = #{modifiedDateField,jdbcType=VARCHAR},
      application_id_field    = #{applicationIdField,jdbcType=VARCHAR},
      sync_type               = #{syncType,jdbcType=INTEGER},
      order_id                = #{orderId,jdbcType=VARCHAR},
      status                  = #{status,jdbcType=INTEGER},
      modified_date           = CURRENT_TIMESTAMP

    WHERE id = #{id}
  </update>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    DELETE FROM sync_setting
    WHERE id = #{id}
  </delete>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
    SELECT *
    FROM sync_setting
    WHERE id = #{id}
  </select>
  <select id="findAll" parameterType="java.util.Map" resultMap="BaseResultMap">
    SELECT * FROM sync_setting t
    <if test="_parameter != null">
      <include refid="Select_Where_Clause"/>
    </if>
    <if test="orders != null and orders.size() > 0">
      ORDER BY
      <foreach collection="orders" item="order" index="index" separator=",">
        ${order}
      </foreach>
    </if>
    <if test="length > 0">
      LIMIT 0, ${length}
    </if>
  </select>
  <select id="isExist" resultType="java.lang.Boolean">
    SELECT COUNT(0) AS "Count"
    FROM sync_setting
    WHERE id = #{id}
  </select>
  <select id="getSettings" resultMap="BaseResultMap">
    SELECT *
    FROM sync_setting
    WHERE status = 1
    ORDER BY order_id
  </select>
</mapper>
